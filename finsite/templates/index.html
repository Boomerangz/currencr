{% extends 'base.html' %}
{% load i18n %}
{% block js %}
<script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
<script src="/static/js/chart-lib.js"></script>
<script src="/static/js/preview-chart.js"></script>
{% endblock %}
{% block content %}
<div style="background-color: #666666; width: auto; height: 100px;"></div>

<div style="display: flex; flex-direction: row; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; margin-top: 30px;">
    <script>
        function addChart(canvasID, data) {
            console.log(canvasID, data.length)
            var canvas = document.getElementById(canvasID);
            canvas.width = 280;
            canvas.height = 70;
            console.log(canvas)

            stage = new createjs.Stage(canvasID);
            createjs.Ticker.setFPS(1);
            console.log(stage);

            var chart = stage.addChild(new cr.PreviewChart(canvas.width - 10, canvas.height));
            chart.x = 5;
            chart.set(data.slice(-24));
            stage.update();
        }
    </script>
    <ul class="list-group" style="min-width: 320px;">
        <li class="list-group-item" style="background-color: #002D40; color: #EEE;">
            <h6 class="mb-0">{% trans "History and forecasts" %}</h6>
        </li>
        {% for currency in currency_list %}
        <li class="list-group-item list-group-item-action">
            <a href="/{{ currency.code }}/">{{ currency.name }}</a> {% if currency.exchange > 0 %}<b style="margin-left:10px;">{{ currency.code }}</b>{% endif %}
            <span style="margin-left:10px">{{ currency.current_price|floatformat:3 }}</span>
            <span style="margin-left:10px; margin-right: 10px;" class="{% if currency.up %}text-success{% elif currency.down %}text-danger{%endif%}">({{ currency.percents|floatformat:3 }} %)</span>
            <canvas id="preview-canvas-{{ currency.name }}" style="display: block; float: right;"></canvas>
            <script>
                var data = {{ currency.day_history }};
                var canvasID = "preview-canvas-{{ currency.name }}";
                addChart(canvasID, data);
            </script>
        </li>
        {% endfor %}
    </ul>
    <div style="margin-left: 25px; padding-bottom: 15px;">
        <blockquote class="blockquote" style="border-color: #002D40; margin-bottom: 30px; ">
            <p class="h2">Прогнозы для популярных криптовалют</p>
            <p>Графики с детальными поминутными прогнозами, основанные на работе нейронных сетей и алгоритмах статистического анализа.</p>
            <p>Оцените наши 60-и минутные прогнозы и возьмите на вооружение ещё один инструмент успешного трейдинга. Ищете для себя наиболее удачные точки входа и выхода в вашем интрадей.</p>
            <p class="lead">Мы постоянно улучшаем качество прогнозов, пробуем нововведения и отбираем для публикации только лучшие подходы.</p>
            <hr class="my-4">
            <p class="lead">
                Присоединяйтесь к
                <button type="button" class="btn btn-primary btn-sm" style="background-color: #002D40; border-color: #002D40;">
                    нашему каналу
                </button> в Telegram
            </p>
        </blockquote>
        <div style="background-color: #999999; width: auto; height: 200px;">
        </div>
    </div>
</div>

<div style="background-color: #666666; width: auto; height: 100px;"></div>

{% if news_list %}
<ul class="list-group" style="margin-bottom: 30px; margin-top: 30px;">
    <li class="list-group-item" style="background-color: #002D40; color: #FFF;">
        <h6 class="mb-0">{% trans "News" %}</h6>
    </li>
    {% for new in news_list %}
    <li class="list-group-item list-group-item-action">
        <a href="/news/{{ new.id }}/">{{ new.title }}</a>
    </li>
    {% endfor %}
</ul>

<div style="background-color: #002D40; width: auto; height: 100px;"></div>
{% endif %}
{% endblock %}